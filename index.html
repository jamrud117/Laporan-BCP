<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Laporan BCP BC 2.7 Masuk</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />

    <!-- DataTables -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
    />

    <!-- Buttons CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css"
    />

    <!-- CUSTOM CSS -->
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- üåê NAVBAR -->
    <nav class="main-nav">
      <div class="nav-container">
        <div class="nav-logo">üìä Laporan BCP</div>
      </div>
    </nav>

    <div class="container-fluid py-4">
      <!-- UPLOAD FORM -->
      <div class="section-card">
        <h5 class="fw-bold mb-4 text-center">
          Upload Excel Dokumen (Multiple)
        </h5>

        <form id="uploadForm" enctype="multipart/form-data">
          <div class="row g-3 align-items-end">
            <div class="col-md-4">
              <label class="form-label fw-semibold">File Excel</label>
              <input type="file" name="files[]" class="form-control" multiple />
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Tanggal Masuk</label>
              <input type="date" name="tanggal_masuk" class="form-control" />
            </div>

            <div class="col-md-2">
              <button class="btn btn-uploads btn-primary w-100 mt-4">
                üìÅ Uploads
              </button>
            </div>

            <div class="col-md-2">
              <button
                type="button"
                class="btn btn-action btn-warning w-100 mt-4"
                data-bs-toggle="modal"
                data-bs-target="#actionModal"
              >
                ‚öôÔ∏è Action
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- TABLE -->
      <div class="custom-table-wrapper mt-3">
        <div id="dt-top-controls"></div>
        <div class="table-container">
          <table id="excelTable" class="table table-bordered nowrap">
            <thead>
              <tr>
                <th>No</th>
                <th>Jenis Dokumen</th>
                <th>Tanggal Masuk</th>
                <th>Nomor AJU</th>
                <th>Nopen</th>
                <th>Tanggal Dokumen</th>
                <th>Dokumen Pelengkap</th>
                <th>Supplier</th>
                <th>Jumlah Kemasan</th>
                <th>Tipe Kemasan</th>
                <th>Quantity</th>
                <th>Satuan</th>
                <th>Kode Barang</th>
                <th>Nama Item</th>
                <th>Seri Barang</th>
                <th>NW</th>
                <th>GW</th>
                <th>Valuta</th>
                <th>CIF</th>
                <th>NDPBM</th>
                <th>Harga Penyerahan</th>
                <th>Kode Tujuan</th>
                <th>Tujuan Pengiriman</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="dt-bottom-pagination" class="mt-2"></div>
      </div>
    </div>

    <!-- MODAL -->
    <div class="modal fade" id="actionModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold">‚öôÔ∏è Update & Delete Actions</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body">
            <ul class="nav nav-tabs mb-3">
              <li class="nav-item">
                <button
                  class="nav-link active"
                  data-bs-toggle="tab"
                  data-bs-target="#tabUpdate"
                >
                  Update
                </button>
              </li>
              <li class="nav-item">
                <button
                  class="nav-link"
                  data-bs-toggle="tab"
                  data-bs-target="#tabDelete"
                >
                  Delete
                </button>
              </li>
              <li class="nav-item">
                <button
                  class="nav-link"
                  data-bs-toggle="tab"
                  data-bs-target="#tabExport"
                >
                  Export
                </button>
              </li>
            </ul>

            <div class="tab-content">
              <!-- TAB UPDATE -->
              <div class="tab-pane fade show active" id="tabUpdate">
                <form id="modalUpdateForm" enctype="multipart/form-data">
                  <label class="form-label fw-semibold"
                    >File Excel Update</label
                  >
                  <input
                    type="file"
                    name="file_update"
                    class="form-control mb-3"
                  />
                  <button class="btn btn-warning w-100">Update Sekarang</button>
                </form>
              </div>

              <!-- TAB DELETE -->
              <div class="tab-pane fade" id="tabDelete">
                <form id="modalDeleteForm">
                  <label class="form-label fw-semibold mt-2"
                    >Dari Tanggal</label
                  >
                  <input
                    type="date"
                    id="delStartModal"
                    class="form-control mb-2"
                  />

                  <label class="form-label fw-semibold">Sampai Tanggal</label>
                  <input
                    name="tanggal_masuk"
                    type="date"
                    id="delEndModal"
                    class="form-control mb-3"
                  />

                  <button class="btn btn-danger w-100">Delete</button>
                </form>
              </div>

              <!-- TAB EXPORT -->
              <div class="tab-pane fade" id="tabExport">
                <div class="p-2">
                  <button
                    id="excelJSBtn"
                    type="button"
                    class="btn btn-success w-100 py-2"
                  >
                    üì• Export Excel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- MODAL UPDATE TANGGAL MASUK PER DOKUMEN -->
    <div class="modal fade" id="updateTanggalModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="updateTanggalForm">
            <div class="modal-header">
              <h5 class="modal-title fw-bold">‚úèÔ∏è Update Tanggal Masuk</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>

            <div class="modal-body">
              <input type="hidden" id="updateNomorAju" name="nomor_aju" />

              <label class="form-label fw-semibold">Tanggal Masuk</label>
              <input
                type="text"
                id="updateTanggalMasuk"
                name="tanggal_masuk"
                class="form-control"
                placeholder="YYYY-MM-DD"
                required
              />
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">
                Batal
              </button>
              <button class="btn btn-warning" type="submit">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- TOAST -->
    <div
      class="toast-container position-fixed top-0 end-0 p-3"
      style="z-index: 99999"
    >
      <div
        id="mainToast"
        class="toast align-items-center text-bg-primary border-0"
        role="alert"
      >
        <div class="d-flex">
          <div class="toast-body" id="toastMessage"></div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
          ></button>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
      <p>¬© 2025 YXF Tools ‚Äî All rights reserved | Made with üí° by YF</p>
    </footer>

    <!-- JS DEPENDENCY -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    <!-- CUSTOM JS -->
    <script src="assets/js/app.js"></script>
    <script>
      const actionModal = document.getElementById("actionModal");
      actionModal.addEventListener("hidden.bs.modal", () => {
        document.querySelector("[data-bs-target='#actionModal']")?.focus();
      });
      const updateModal = document.getElementById("updateTanggalModal");
      updateModal.addEventListener("hidden.bs.modal", () => {
        document.body.focus();
      });
      function deleteDocument(aju) {
        Swal.fire({
          title: "Konfirmasi Hapus",
          text: `Apakah Anda yakin ingin menghapus AJU ${aju}?`,
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Ya, hapus!",
          cancelButtonText: "Batal",
          reverseButtons: true,
        }).then((result) => {
          if (result.isConfirmed) {
            fetch("assets/php/delete.php?aju=" + encodeURIComponent(aju))
              .then((response) => response.text())
              .then((msg) => {
                Swal.fire({
                  toast: true,
                  position: "top-end",
                  icon: "success",
                  title: msg,
                  showConfirmButton: false,
                  timer: 2500,
                  timerProgressBar: true,
                });
                loadTable();
              })
              .catch(() => {
                Swal.fire({
                  toast: true,
                  position: "top-end",
                  icon: "error",
                  title: "Gagal menghapus dokumen.",
                  showConfirmButton: false,
                  timer: 2500,
                  timerProgressBar: true,
                });
              });
          }
        });
      }
    </script>
  </body>
</html>
